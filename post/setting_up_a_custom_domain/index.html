<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>Setting up a custom domain for github pages | Noam Lerner's Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><meta property="og:title" content="Setting up a custom domain for github pages"><meta property="og:description" content="In the last few weeks, I had to take some sick time from work and attend to my kids who are at home while my wife wasn&rsquo;t feeling well. After spending all day running after them, I needed to unwind at the evening. I played some Eleven Table Tennis and then went to play around with creating a custom domain for the blog, instead of having it being served from bugok."><meta property="og:type" content="article"><meta property="og:url" content="https://bugok.github.io/post/setting_up_a_custom_domain/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-03-17T08:14:09+02:00"><meta property="article:modified_time" content="2022-03-17T08:14:09+02:00"><meta itemprop=name content="Setting up a custom domain for github pages"><meta itemprop=description content="In the last few weeks, I had to take some sick time from work and attend to my kids who are at home while my wife wasn&rsquo;t feeling well. After spending all day running after them, I needed to unwind at the evening. I played some Eleven Table Tennis and then went to play around with creating a custom domain for the blog, instead of having it being served from bugok."><meta itemprop=datePublished content="2022-03-17T08:14:09+02:00"><meta itemprop=dateModified content="2022-03-17T08:14:09+02:00"><meta itemprop=wordCount content="1096"><meta itemprop=keywords content="blog,github,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting up a custom domain for github pages"><meta name=twitter:description content="In the last few weeks, I had to take some sick time from work and attend to my kids who are at home while my wife wasn&rsquo;t feeling well. After spending all day running after them, I needed to unwind at the evening. I played some Eleven Table Tennis and then went to play around with creating a custom domain for the blog, instead of having it being served from bugok."><link rel=stylesheet href=/css/bundle.css><link rel=stylesheet href=/css/custom.css><link rel=icon href=/icons/16.png sizes=16x16 type=image/png><link rel=icon href=/icons/32.png sizes=32x32 type=image/png><link rel=manifest href=/manifest.json><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-103582753-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="body kind-page"><header class=header><a class=logo href=/>Noam Lerner's Blog</a><nav class="main-nav main-nav--right" role=navigation><button id=toggle class=main-nav__btn aria-label="Menu toggle" aria-expanded=false tabindex=0><div class=main-nav__btn-box tabindex=-1><svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18"><path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/><path class="icon-menu__x" d="M11.55 9 18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55.0 9 6.45 15.45.0 18 2.55 11.55 9z"/></svg></div></button><ul id=menu class=main-nav__list><li class=main-nav__item><a class=main-nav__link href=/about/><span class=main-nav__text>About</span></a></li></ul></nav></header><div class=primary><main class=main><nav class="breadcrumb block" aria-label=breadcrumb><ol class=breadcrumb__list><li class=breadcrumb__item><a class=breadcrumbs__link href=/>Home</a></li><li class=breadcrumb__item><a class=breadcrumbs__link href=/post/>Posts</a></li><li class="breadcrumbs__item breadcrumb__item--active" aria-current=page>Setting up a custom domain for github pages</li></ol></nav><div class="single block"><article class=entry><div class="entry__meta meta mb"><time class="entry__meta-published meta-published" datetime=2022-03-17T08:14:09+02:00>March 17, 2022</time></div><h1 class=entry__title>Setting up a custom domain for github pages</h1><div class=entry__content><p>In the last few weeks, I had to take some sick time from work and attend to my kids who are at home while my wife wasn&rsquo;t feeling well. After spending all day running after them, I needed to unwind at the evening. I played some <a href=https://www.oculus.com/experiences/quest/1995434190525828/>Eleven Table Tennis</a> and then went to play around with creating a custom domain for the blog, instead of having it being served from <code>bugok.github.io</code>.</p><h2 id=but-why>But why?</h2><p>Things are working fine with the <code>github.io</code> domain, I also don&rsquo;t expect for the blog to have a lot of volume. This was purely an exercise to make this work. One of the reasons for this is to see if I can make things work in the &lsquo;real-world&rsquo;. I&rsquo;ve spent over 8 years working for Facebook/Meta - so I wonder how things are working outside of that infrastructure.</p><h2 id=getting-started>Getting started</h2><p>First, I had to buy a domain. I didn&rsquo;t think about this much, but Googling some options, I came across <a href=https://www.cloudflare.com/>cloudflare</a> which came up with various recommendations from people I&rsquo;ve worked with. Also, I&rsquo;ve remembered reading <a href=https://blog.cloudflare.com/october-2021-facebook-outage/>a good blog post of theirs</a> about Facebook&rsquo;s outage from October 2021. That made me think highly of cloudflare&rsquo;s technical competence.</p><p>I signed up for the free plan, bought the noamlerner.com domain, and started to play around.</p><h3 id=handling-the-sub-domain-and-path>Handling the sub-domain and path</h3><p>When thinking about where I want to blog to be, I had <code>blog.noamlerner.com</code> in mind. Also, when configuring the blog for <code>github.io</code>, I used the <code>/blog</code> path, in case I&rsquo;d like to deploy multiple sites to the same <code>bugok.github.io</code> subdomain. The latter made things a bit harder to configure.</p><p>Started off with setting a <code>CNAME</code> entry for <code>blog.noamlerner.com</code> in cloudflare:
<img src=/cloudflare_blog_subdomain.png alt>.</p><p>Then, I configured the custom domain in the github pages settings to be <code>blog.noamlerner.com</code>. Eventually, I got this:
<img src=/no_static_content.png alt></p><p>Obviously, something is working, but some things aren&rsquo;t. The static content isn&rsquo;t available. As a friend recommended, I launched Chrome&rsquo;s developer tools and started poking around. I found that images weren&rsquo;t rendering properly, because they weren&rsquo;t in the right place (I manually changed the the paths to make sure).</p><p>Eventually, I decided to move away from having the <code>/blog</code> path, and committed <a href=https://github.com/bugok/blog/commit/d9c2f31f0bfae657d4f2c6ddbd16c5cc045c016f>this commit</a> to change <code>baseurl = "https://bugok.github.io/blog/"</code> to <code>baseurl = "https://bugok.github.io/"</code> in my hugo <code>config.toml</code>. Now the blog is at the root of the website. The new domain isn&rsquo;t working, but at least it&rsquo;ll be easier to debug. Also, I&rsquo;ve decided to put the blog under <code>www.noamlerner.com</code>.</p><h3 id=ssl---removing-cloudflares-https-option>SSL - removing cloudflare&rsquo;s https option</h3><p>Github pages has an &rsquo;enforce https&rsquo; option, which was disabled for me. I wanted to make sure that traffic to my domain will be https by default. I essentially needed to make my cloudflare configuration as simple as possible.</p><p>When I started playing with cloudflare, I got a suggestion to enable <a href=https://developers.cloudflare.com/ssl/edge-certificates/additional-options/always-use-https/>Always Use HTTPS</a>. Seems like a good idea, but this, I believe, threw off github&rsquo;s HTTPS configuration, so I removed that.</p><h3 id=ssl---removing-cloudflares-proxy>SSL - removing cloudflare&rsquo;s proxy</h3><p>Next, I tried removing the cloudflare proxy. As you can see in the previous screenshot from cloudflare, the default of the dns entry is to have &lsquo;proxy status&rsquo; be enabled. The <a href=https://developers.cloudflare.com/dns/manage-dns-records/reference/proxied-dns-records/>proxy status documentation page</a>:</p><blockquote><p>When you proxy an A, AAAA, or CNAME DNS record for your application (also known as orange-clouding), DNS queries for these records will resolve to Cloudflare Anycast IPs instead of their original DNS target.</p><p>This means that all requests intended for proxied hostnames will go to Cloudflare first and then be forwarded to your origin server. This behavior allows Cloudflare to optimize, cache, and protect all requests for your application.</p></blockquote><p>Of course, we all want optimizations, cache and protection for our website - but only if they are working. Therefore, I&rsquo;ve removed the proxying:</p><p><img src=/no_cloudflare_proxy.png alt></p><p>Looking at the output of dig, I saw what I was expecting:</p><pre tabindex=0><code>$ dig www.noamlerner.com +nostats +nocomments +nocmd

; &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; www.noamlerner.com +nostats +nocomments +nocmd
;; global options: +cmd
;www.noamlerner.com.		IN	A
www.noamlerner.com.	300	IN	CNAME	bugok.github.io.
bugok.github.io.	3093	IN	A	185.199.109.153
bugok.github.io.	3093	IN	A	185.199.108.153
bugok.github.io.	3093	IN	A	185.199.111.153
bugok.github.io.	3093	IN	A	185.199.110.153
</code></pre><p>Before disabling the proxy, <code>www.noamlerner.com</code> was pointing to a cloudflare server.</p><p>Lastly, I went back to the github pages settings page, and saw this:
<img src=/github_cert_provisioning.png alt>.</p><p>And a little while after - I got this nice clean lock in Chrome:</p><p><img src=/noamlerner_chrome_lock.png alt></p><h3 id=dns---setting-an-entry-for-the-root-domain>DNS - setting an entry for the root domain</h3><p>Getting SSL to work required some DNS and at this point, everything seemed to be working. However, the github pages settings page had a complaint that the custom domain is improperly configured:</p><p><img src=/domain_improperly_configured.png alt></p><p>Again, Googling a bit, I couldn&rsquo;t find something which adds up. When following the <a href=https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site#configuring-a-subdomain>github subdomain guide</a>, everything seemed to be working.</p><p>Eventually, it clicked. The warning isn&rsquo;t for <code>www.noamlerner.com</code>, but for <code>noamlerner.com</code>. This corresponded with Cloudflare having a warning at the top of their console about me not having a DNS entry for the root domain. I&rsquo;ve added another CNAME for <code>noamlerner.com</code> to resolve to <code>bugok.github.io</code>, and a few seconds later - github was happy:</p><p><img src=/github_custom_domain_working.png alt></p><ul><li>Github actions removed CNAME entry</li><li>github actions override cname</li><li>cloudflare DNS proxy -</li><li>custom domain from github pages</li></ul><h3 id=dns---cname-with-github-actions>DNS - CNAME with github actions</h3><p>When setting a custom domain for github pages, what happens is that a file named <code>CNAME</code> is created with the content of the domain. I guess github is looking for that file to configure some things. When I was experimenting with getting this to work, I found that the custom domain and the <code>CNAME</code> file were removed.</p><p>Turns out that the github actions I have configured remove everything from the <code>gh-pages</code> branch (which is the branch deployed to github pages). In order to fix that, I tried:</p><ul><li>Pushing a <code>CNAME</code> file to the <code>main</code> branch (didn&rsquo;t help)</li><li>Create another action to create the file (didn&rsquo;t work)</li></ul><p>What did work, is to read the manual, and see that the action I used to publish my hugo site to github pages (<a href=https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-add-cname-file-cname>peaceiris/actions-gh-pages</a>) has a <code>cname</code> option to create that <code>CNAME</code> file with the right content. <a href=https://github.com/bugok/blog/commit/d78ac8613dbefac1e145619a27ecae8a9f2e9e38>This commit</a> solved the issue.</p><h3 id=backwards-compatibility-of-blog>Backwards compatibility of <code>/blog</code></h3><p>But what happens if the millions of people who have the <code>bugok.github.io/blog</code> already bookmarked? How do I prevent them from getting errors and allowing them access to my new domain? Turns out, that going to <code>bugok.github.io/blog</code> resolves to <code>www.noamlerner.com</code>. But how?</p><p>Opening up the network tab in chrome developer tools, I saw this:
<img src=/blog_network_requests.png alt></p><p>Then, looking at the first response headers:</p><p><img src=/github_response_headers.png alt></p><h3 id=finally>Finally</h3><p>The blog is working, served from noamlerner.com, using a github repository, github actions which push to github pages, which is fronted by cloudflare.</p></div><footer class=entry__footer><div class=entry__tags><a class="entry__tag btn" href=/tags/blog/>blog</a>
<a class="entry__tag btn" href=/tags/github/>github</a></div><div class="entry__share share"><a class="share__link btn" title="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbugok.github.io%2fpost%2fsetting_up_a_custom_domain%2f" target=_blank rel="noopener noreferrer" onclick='return window.open(this.href,"Share on Facebook","width=800,height=600,toolbar=0,status=0"),!1'><svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg></a><a class="share__link btn" title="Share on LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fbugok.github.io%2fpost%2fsetting_up_a_custom_domain%2f&title=Setting%20up%20a%20custom%20domain%20for%20github%20pages" target=_blank rel="noopener noreferrer" onclick='return window.open(this.href,"Share on LinkedIn","width=640,height=480,toolbar=0,status=0"),!1'><svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></div></footer></article></div></main><div class="authorbox block"><div class=author><figure class=author__avatar><img class=author__img alt="Noam Lerner avatar" src=/avatar.png height=90 width=90></figure><div class=author__body><div class=author__name>Noam Lerner</div></div></div></div><script src=https://utteranc.es/client.js repo=bugok/blog issue-term=pathname label=utterances theme=github-dark-orange crossorigin=anonymous async></script></div><footer class=footer><div class="footer__social social"><a class=social__link target=_blank rel="noopener noreferrer" href=https://www.facebook.com/bugok><svg class="social__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://linkedin.com/in/noamler><svg class="social__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://github.com/bugok><svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg></a></div><div class=footer__copyright>© 2022 Noam Lerner's Blog. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer><script src=/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script src=/js/custom.js></script></body></html>