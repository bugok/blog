<!doctype html><html class=no-js lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#1b1b1b"><title>Automating my AC fan using Sensibo's API | Noam Lerner's Blog</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="How I used Sensibo's API to automate fan actions using Google assistant and IFTTT"><meta property="og:title" content="Automating my AC fan using Sensibo's API"><meta property="og:description" content="How I used Sensibo's API to automate fan actions using Google assistant and IFTTT"><meta property="og:type" content="article"><meta property="og:url" content="https://www.noamlerner.com/post/automating_my_ac_fan_using_sensibo_api/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-06-05T21:07:18+03:00"><meta property="article:modified_time" content="2023-06-05T21:07:18+03:00"><meta itemprop=name content="Automating my AC fan using Sensibo's API"><meta itemprop=description content="How I used Sensibo's API to automate fan actions using Google assistant and IFTTT"><meta itemprop=datePublished content="2023-06-05T21:07:18+03:00"><meta itemprop=dateModified content="2023-06-05T21:07:18+03:00"><meta itemprop=wordCount content="716"><meta itemprop=keywords content="sensibo,ifttt,Google assistant,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automating my AC fan using Sensibo's API"><meta name=twitter:description content="How I used Sensibo's API to automate fan actions using Google assistant and IFTTT"><link rel=stylesheet href=https://www.noamlerner.com/css/bundle.css><link rel=stylesheet href=https://www.noamlerner.com/css/custom.css><link rel=icon href=https://www.noamlerner.com/icons/16.png sizes=16x16 type=image/png><link rel=icon href=https://www.noamlerner.com/icons/32.png sizes=32x32 type=image/png><link rel=manifest href=https://www.noamlerner.com/manifest.json><script async src="https://www.googletagmanager.com/gtag/js?id=G-4VW03XLR18"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4VW03XLR18",{anonymize_ip:!1})}</script></head><body class="body kind-page"><header class=header><a class=logo href=https://www.noamlerner.com/>Noam Lerner's Blog</a><nav class="main-nav main-nav--right" role=navigation><button id=toggle class=main-nav__btn aria-label="Menu toggle" aria-expanded=false tabindex=0><div class=main-nav__btn-box tabindex=-1><svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18"><path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/><path class="icon-menu__x" d="M11.55 9 18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55.0 9 6.45 15.45.0 18 2.55 11.55 9z"/></svg></div></button><ul id=menu class=main-nav__list><li class=main-nav__item><a class=main-nav__link href=https://www.noamlerner.com/about/><span class=main-nav__text>About</span></a></li><li class=main-nav__item><a class=main-nav__link href=https://www.noamlerner.com/whoami/><span class=main-nav__text>Whoami</span></a></li></ul></nav></header><div class=primary><main class=main><nav class="breadcrumb block" aria-label=breadcrumb><ol class=breadcrumb__list><li class=breadcrumb__item><a class=breadcrumbs__link href=https://www.noamlerner.com/>Home</a></li><li class=breadcrumb__item><a class=breadcrumbs__link href=https://www.noamlerner.com/post/>Posts</a></li><li class="breadcrumbs__item breadcrumb__item--active" aria-current=page>Automating my AC fan using Sensibo's API</li></ol></nav><div class="single block"><article class=entry><div class="entry__meta meta mb"><time class="entry__meta-published meta-published" datetime=2023-06-05T21:07:18+03:00>June 05, 2023</time><div class="entry__meta-tags meta-tags"><span class=meta-tags__list>Tags:
<a class=meta-tags__link href=https://www.noamlerner.com/tags/sensibo/ rel=tag>sensibo</a>,
<a class=meta-tags__link href=https://www.noamlerner.com/tags/ifttt/ rel=tag>ifttt</a>,
<a class=meta-tags__link href=https://www.noamlerner.com/tags/google-assistant/ rel=tag>Google assistant</a></span></div></div><h1 class=entry__title>Automating my AC fan using Sensibo's API</h1><div class=entry__content><p>In this post I&rsquo;d like to share how I used <a href=https://ifttt.com/>IFTTT</a> and <a href=https://sensibo.com/>Sensibo</a> to overcome a missing functionality in Google Assistant.</p><h2 id=what-i-have>What I have</h2><p>I own a <a href=https://sensibo.com/products/sensibo-sky>Sensibo Sky</a> which allows me to control my living room&rsquo;s air conditioner unit. I also own a Google Home Mini which allows me to trigger actions on my Google Home devices using voice commands.</p><p>Sensibo&rsquo;s products integrate with Google Home, which means I can use voice commands to <a href=https://support.sensibo.com/l/en/article/wopsotkhmr-google-home>perform several actions</a> on my air conditioning unit.</p><h2 id=what-i-was-missing>What I was missing</h2><p>I wanted to have the ability to change the fan&rsquo;s speed using voice commands. I couldn&rsquo;t find an example of such a phrase in the documentation, so I contacted Sensibo&rsquo;s support. They confirmed that there&rsquo;s no support for such a phrase.</p><h2 id=identifying-the-building-blocks>Identifying the building blocks</h2><p>I posted in a home automation Facebook group if someone knows how to do this, and <a href=https://www.linkedin.com/in/itay-levy-b9b342a/>Itay</a> reached out and suggested that I&rsquo;d use <a href=https://ifttt.com>IFTTT</a> to get it done. He also sent me <a href=https://sensibo.github.io/>Sensibo&rsquo;s API page</a> - which has the API to change the fan speed.</p><p>For the &lsquo;if&rsquo; in IFTTT, IFTTT supports <a href=https://ifttt.com/google_assistant_v2>Google assistant</a>. This means I could use a voice command on my Google home devices (like my Google home mini) to trigger an IFTTT command.</p><p>For the &rsquo;that&rsquo; in IFTTT, IFTTT supports <a href=https://ifttt.com/maker_webhooks/actions/make_web_request>web-hooks action type</a>. This means I could perform an HTTP call using IFTTT. Specifically, I could call Sensibo&rsquo;s API.</p><h2 id=shell-first>Shell-first</h2><p>I started with the action. I wanted to get to a point where I can run a curl command which changes the fan&rsquo;s speed.</p><p>Getting a Sensibo API key was relatively easy. Under the menu in <code>https://home.sensibo.com/</code> I could find how to create an API key:</p><p><img src=sensibo_menu.png alt></p><p>Then, I started crafting the API call. First, I needed a way to get my Sensibo device&rsquo;s ID. That was easy, as there&rsquo;s an example of that exact command in the <a href=https://sensibo.github.io/#overview>documentation&rsquo;s examples</a>:</p><pre tabindex=0><code>curl -X GET &#39;https://home.sensibo.com/api/v2/users/me/pods?fields=*&amp;apiKey={api_key}&#39;
</code></pre><p>This spills out all the information about your devices. You can specify the <code>id</code> field in the query to get only the device id:</p><pre tabindex=0><code>curl -X GET &#39;https://home.sensibo.com/api/v2/users/me/pods?fields=id&amp;apiKey={api_key}&#39;
</code></pre><p>Which gets something like this:</p><pre tabindex=0><code>{&#34;status&#34;: &#34;success&#34;, &#34;result&#34;: [{&#34;id&#34;: &#34;XXXXXX&#34;}]}
</code></pre><p>Then, I used the &lsquo;<a href=https://sensibo.github.io/#patch-/pods/-device_id-/acStates/-property->change only one property of the AC state</a>&rsquo; API call to change the fan speed:</p><pre tabindex=0><code>curl -X PATCH &#39;https://home.sensibo.com/api/v2/pods/{device_id}/acStates/fanLevel?apiKey={api_key}&#39; -d &#39;{&#34;newValue&#34;: &#34;low&#34;}
</code></pre><p>I toggled between <code>"low"</code> and <code>"medium"</code> to change the state. When hearing the air conditioning unit beep - I knew that I was on the right path. Looking at Sensibo mobile app confirmed that the state has been changed.</p><p>At this point, I called my daughter (who was watching TV). I asked her if she wants to see something cool. I showed her my shell, and told her that I&rsquo;m going to change the AC state by pressing a button. When hitting &lsquo;return&rsquo; and hearing the beep, her eyes opened wide open. After a few seconds, she went back to watching TV.</p><h2 id=using-ifttt-to-hook-everything-together>Using IFTTT to hook everything together</h2><p>I connected my IFTT account to Google Assistant, and created a new applet.
First, I defined a &lsquo;Set AC level to low&rsquo; scene as the &lsquo;if&rsquo;. Then, I defined a &lsquo;make a web request&rsquo; as the &rsquo;then&rsquo;. I crafted the URL based on the curl request, specified <code>PATCH</code> as the method, chose <code>application/json</code> as the content type and set <code>{"newValue": "low"}</code> as the body.</p><p>Then, I want to the living room, called &lsquo;hey Google, activate set AC level to low&rsquo;. Google confirmed with success, but nothing happened. Turns out that IFTTT allows to see the logs of the latest invocations of the applet:</p><p><img src=applet_failure.png alt></p><p>I had a copy-paste error. I copied the curl command&rsquo;s apostrophe. Facepalm. I removed that, and it worked!</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/_aPykq9k8gQ style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>In the video, you can:</p><ol><li>See that Google home was able to trigger the scene</li><li>See that the Sensibo Sky sends the command (by flashing the blue light)</li><li>The air conditioning unit beeps when receiving the status update command</li></ol><p>I then created a similar applet for setting the AC level to &lsquo;medium&rsquo;.</p><h2 id=what-i-didnt-want-to-use>What I didn&rsquo;t want to use</h2><p>IFTTT has a <a href=https://ifttt.com/sensibo>Sensibo integration</a>, which simplifies how to do perform basic actions. But, those actions require you to set multiple states of the AC. I assume that it&rsquo;s using <a href=https://sensibo.github.io/#post-/pods/-device_id-/acStates>this</a> API call. I wanted to keep all other states, but change the fan level.</p></div><footer class=entry__footer><div class=entry__tags><a class="entry__tag btn" href=https://www.noamlerner.com/tags/sensibo/>sensibo</a>
<a class="entry__tag btn" href=https://www.noamlerner.com/tags/ifttt/>ifttt</a>
<a class="entry__tag btn" href=https://www.noamlerner.com/tags/google-assistant/>Google assistant</a></div><div class="entry__share share"><a class="share__link btn" title="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.noamlerner.com%2fpost%2fautomating_my_ac_fan_using_sensibo_api%2f" target=_blank rel="noopener noreferrer" onclick='return window.open(this.href,"Share on Facebook","width=800,height=600,toolbar=0,status=0"),!1'><svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg></a><a class="share__link btn" title="Share on LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.noamlerner.com%2fpost%2fautomating_my_ac_fan_using_sensibo_api%2f&title=Automating%20my%20AC%20fan%20using%20Sensibo%27s%20API" target=_blank rel="noopener noreferrer" onclick='return window.open(this.href,"Share on LinkedIn","width=640,height=480,toolbar=0,status=0"),!1'><svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a></div></footer></article></div></main><script src=https://utteranc.es/client.js repo=bugok/blog issue-term=pathname label=utterances theme=github-dark-orange crossorigin=anonymous async></script></div><footer class=footer><div class="footer__social social"><a class=social__link target=_blank rel="noopener noreferrer" href=https://www.facebook.com/bugok><svg class="social__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://linkedin.com/in/noamler><svg class="social__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg></a><a class=social__link target=_blank rel="noopener noreferrer" href=https://github.com/bugok><svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg></a></div><div class=footer__copyright>© 2023 Noam Lerner's Blog. <span class=footer__copyright-credits>Powered by <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/vimux/binario rel="nofollow noopener" target=_blank>Binario</a> theme.</span></div></footer><script src=https://www.noamlerner.com/js/menu.js></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script src=https://www.noamlerner.com/js/custom.js></script></body></html>